<div [ngClass]="{'busy': notifyTarget.busy}">
  <app-panel-expander [walk]="walk" [collapsable]="true" [collapseAction]="'exit edit and return to view'" [expandAction]="'show details of walk fullscreen'" [expandable]="true" [expandEdits]="true">
  </app-panel-expander>
  <tabset *ngIf="walk">
    <tab heading="Date and Location">
      <div class="thumbnail thumbnail-admin-edit">
        <div class="row">
          <div class="col-sm-6">
            <div class="form-group">
              <label for="walk-date">Walk Date</label>

              <div class="input-group">
                <input [disabled]="!allowAdminEdits()"
                       [ngModel]="walkDate"
                       (bsValueChange)="onDateChange($event)"
                       placeholder="enter date of walk"
                       #dp="bsDatepicker"
                       bsDatepicker [bsConfig]="{  isAnimated: true, dateInputFormat: 'DD-MMM-YYYY',
                               containerClass: 'theme-ramblers'}"
                       type="text" class="form-control input-sm"
                       id="walk-date"/>
                <div class="input-group-btn">
                  <button [disabled]="!allowAdminEdits()"
                          class="btn btn-default btn-sm"
                          (click)="dp.toggle()" [attr.aria-expanded]="dp.isOpen"><i
                    class="glyphicon glyphicon-calendar"></i></button>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="form-group">
              <label for="start-time">Start Time</label>
              <input [disabled]="!allowEdits()" [(ngModel)]="walk.startTime"
                     type="text" class="form-control input-sm" id="start-time"
                     placeholder="Enter Start time here">
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4">
            <div class="form-group">
              <label for="distance">Distance</label>
              <input [disabled]="!allowEdits()" [(ngModel)]="walk.distance"
                     type="text" class="form-control input-sm" id="distance"
                     placeholder="Enter Distance here">
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label for="nearest-town">Nearest Town</label>
              <input [disabled]="!allowEdits()" [(ngModel)]="walk.nearestTown"
                     type="text" class="form-control input-sm"
                     id="nearest-town"
                     placeholder="Enter nearest town here">
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label for="walkType">Walk Type</label>
              <select *ngIf="allowDetailView()" [disabled]="!allowEdits()"
                      class="form-control input-sm"
                      placeholder="Enter walk type here"
                      [(ngModel)]="walk.walkType"
                      class="form-control round spaced-controls" id="walkType">
                <option *ngFor="let type of display.walkTypes" [ngValue]="type"
                        [attr.selected]="type == display.walkTypes[0]">{{type}}
                </option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4">
            <div class="form-group">
              <label for="grid-reference">Grid Reference</label>
              <input [disabled]="!allowEdits()" [(ngModel)]="walk.gridReference"
                     type="text" class="form-control input-sm" id="grid-reference"
                     placeholder="Enter Grid Reference here">
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label for="post-code">Postcode</label>
              <input [disabled]="!allowEdits()" [(ngModel)]="walk.postcode"
                     type="text" class="form-control input-sm" id="post-code"
                     placeholder="Enter Postcode here">
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label for="grade">Grade</label>
              <select *ngIf="allowDetailView()" [disabled]="!allowEdits()"
                      class="form-control input-sm"
                      placeholder="Enter Grade here"
                      [(ngModel)]="walk.grade"
                      class="form-control round spaced-controls" id="grade">
                <option *ngFor="let grade of display.grades"
                        [ngValue]="grade"
                        [textContent]="grade"
                        [attr.selected]="grade == display.walkTypes[0]">{{grade}}
                </option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </tab>
    <tab heading="Descriptions">
      <div class="thumbnail thumbnail-admin-edit">
        <div class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <label for="brief-description-and-start-point">Brief Description and Start
                Point</label>
              <textarea [disabled]="!allowEdits()"
                        [(ngModel)]="walk.briefDescriptionAndStartPoint" type="text"
                        class="form-control input-sm" rows="3"
                        id="brief-description-and-start-point"
                        placeholder="Enter Brief description and start point here"></textarea>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <label for="longer-description">Longer Description <a
                [hidden]="longerDescriptionPreview"
                (click)="previewLongerDescription()" [href]=""><i
                class="glyphicon glyphicon-ok-circle markdown-preview-icon"></i> preview</a>
                <a *ngIf="longerDescriptionPreview"
                   (click)="editLongerDescription()" [href]=""><i
                  class="glyphicon glyphicon-pencil markdown-preview-icon"></i>
                  edit</a> </label>
              <p *ngIf="longerDescriptionPreview"
                 (click)="editLongerDescription()"
                 markdown [data]="walk.longerDescription" type="text"
                 id="longer-description-formatted"></p>
              <textarea *ngIf="!longerDescriptionPreview"
                        [disabled]="!allowEdits()"
                        (ngBlur)="previewLongerDescription()"
                        [(ngModel)]="walk.longerDescription" type="text"
                        class="form-control input-sm" rows="5" id="longer-description"
                        placeholder="Enter Longer Description here"></textarea>
            </div>
          </div>
        </div>
      </div>
    </tab>
    <tab heading="Walk Leader">
      <div class="thumbnail thumbnail-admin-edit">
        <div *ngIf="allowAdminEdits()" class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <label for="walk-status">Walk Status</label>
              <select [disabled]="!allowAdminEdits()"
                      (change)="walkStatusChange()"
                      [(ngModel)]="currentStatus"
                      class="form-control input-sm" id="walk-status">
                <option *ngFor="let status of walkStatuses()"
                        [ngValue]="status.eventType"
                        [textContent]="status.description">
                </option>
              </select>
            </div>
          </div>
        </div>
        <div *ngIf="allowAdminEdits()" class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <label for="contact-member">Walk Leader</label>
              <select *ngIf="allowDetailView()" [disabled]="!allowAdminEdits()"
                      (change)="walkLeaderMemberIdChanged()"
                      class="form-control input-sm"
                      [(ngModel)]="walk.walkLeaderMemberId"
                      class="form-control" id="contact-member">
                <option value="">(no walk leader selected)</option>
                <option *ngFor="let member of membersWithAliasOrMe()"
                        [ngValue]="member.memberId"
                        [textContent]="member.name">
                </option>
              </select>
            </div>
          </div>
        </div>
        <div *ngIf="allowAdminEdits()" class="row">
          <div class="col-sm-6">
            <div class="form-group">
              <label for="display-name">Display Name</label>
              <input [disabled]="true" [(ngModel)]="walk.displayName"
                     type="text"
                     class="form-control input-sm" id="display-name"
                     placeholder="Name as displayed to the public and sent to Ramblers in CSV export file">
            </div>
          </div>
          <div class="col-sm-6">
            <div class="form-group">
              <label for="contact-id">Contact Id</label>
              <input [(ngModel)]="walk.contactId"
                     type="text"
                     class="form-control input-sm" id="contact-id"
                     placeholder="Sent to Ramblers in CSV export file">
            </div>
          </div>
        </div>
        <div *ngIf="!allowAdminEdits()" class="row">
          <div *ngIf="!allowAdminEdits()" class="col-sm-12">
            <div class="form-group">
              <label for="display-name-readonly">Walk Leader</label>
              <input [disabled]="true" [(ngModel)]="walk.displayName" type="text"
                     class="form-control input-sm" id="display-name-readonly"
                     placeholder="Name as displayed to the public and sent to Ramblers">
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <label for="contact-phone">Contact Phone</label>
              <input [disabled]="!allowEdits()" [(ngModel)]="walk.contactPhone"
                     type="text" class="form-control input-sm" id="contact-phone"
                     placeholder="Enter contact phone here">
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <label for="contact-email">Contact Email</label>
              <input *ngIf="allowDetailView()" [disabled]="!allowEdits()"
                     [(ngModel)]="walk.contactEmail" type="text"
                     class="form-control input-sm" id="contact-email"
                     placeholder="Enter contact email here">
              <input *ngIf="!allowDetailView()" [disabled]="true"
                     value="(login to see this)" type="text"
                     class="form-control input-sm"
                     id="contact-email-hidden">
            </div>
          </div>
        </div>
      </div>
    </tab>
    <tab heading="Maps and Routes">
      <div class="thumbnail thumbnail-admin-edit">
        <div class="row">
          <div class="col-sm-6 round">
            <h1>Google Maps</h1>
            <p>The map below is a preview of where postcode <strong
              [textContent]="walk.postcode"></strong> will appear on
              Google Maps. This map will be displayed in the detail view of the walk.</p>
            <input type="number" min="1" max="20" *ngIf="false"
                   [(ngModel)]="display.googleMapsConfig.zoomLevel">
            <iframe *ngIf="walk.postcode" class="map-thumbnail-image-dialog"
                    frameborder="0"
                    style="border:0;border-radius: 10px;"
                    [src]="googleMapsUrl" allowfullscreen></iframe>
          </div>
          <div class="col-sm-6">
            <h1>OS Maps</h1>
            <div class="green-bullets-no-rule">
              <ul>
                <li>The fields below are optional and unrelated to data that we send to
                  Ramblers.
                </li>
                <li>Using the fields below, our walks programme can be cross-reference
                  to any OS Map route that one of our members has planned or
                  recorded.
                </li>
                <li>When the URL is populated, a link will be provided on the detail
                  view of the walk. This assumes that the walk is saved as publically
                  viewable.
                </li>
                <li>An OS Map route can be added after the walk has been completed if
                  the route has not already been pre-planned by the walks leader and
                  another member records it on the day.
                </li>
              </ul>
            </div>
            <div class="form-group">
              <label for="related-links-route">OS Maps Route</label>
              <input [(ngModel)]="walk.osMapsRoute"
                     type="text" value="" class="form-control input-sm"
                     id="related-links-route"
                     placeholder="Enter URL to OS Maps Route">
            </div>
            <div class="form-group">
              <label for="related-links-title">OS Maps Title</label>
              <input [(ngModel)]="walk.osMapsTitle"
                     type="text" value="" class="form-control input-sm"
                     id="related-links-title"
                     placeholder="Enter optional title for OS Maps link">
            </div>
            <div class="form-group">
              <div *ngIf="walk.osMapsRoute">
                <br>
                <h3>Link Preview</h3>
                <img class="related-links-image"
                     src="assets/images/local/ordnance-survey.ico"
                     alt=""/>
                <a target="_blank"
                   [href]="walk.osMapsRoute" class="text1">
                                            <span class="related-links-title"
                                                  tooltip-placement="left"
                                                  tooltip="Click to view the route for this walk on Ordnance Survey Maps">
                                          Maps: {{walk.osMapsTitle || walk.briefDescriptionAndStartPoint}}</span></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </tab>
    <tab heading="Related Links">
      <div class="thumbnail thumbnail-admin-edit">
        <div class="row">
          <div class="col-sm-6">
            <div class="row thumbnail thumbnail-campaign-settings third-party-panel">
              <div class="thumbnail-heading">Ramblers</div>
              <div class="form-group">
                <p *ngIf="!insufficientDataToUploadToRamblers() && !ramblersWalkExists()">
                  This walk has not been
                  uploaded to Ramblers yet - check back when date is closer to
                  <b>{{walk.walkDate | displayDate}}</b>.
                </p>
                <p *ngIf="insufficientDataToUploadToRamblers()">
                  {{walkValidations()}}
                </p>
                <div *ngIf="canUnlinkRamblers()">
                  <div class="row">
                    <div class="col-sm-3">
                      <input type="submit" value="Unlink"
                             (click)="unlinkRamblersDataFromCurrentWalk()"
                             title="Remove link between this walk and Ramblers"
                             class="button-form">
                    </div>
                    <div class="col-sm-9">
                      You might need to unlink if the walk on Ramblers
                      Walks and Events Manager has been deleted or
                      replaced by a newer version and you want to re-link
                      it.
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group force-to-bottom" *ngIf="ramblersWalkExists()">
                <h3>Ramblers Link Preview</h3>
                <img class="related-links-image"
                     src="assets/images/ramblers/favicon.ico"
                     alt="Click to view on Ramblers Walks and Events Manager"/>
                <a target="_blank"
                   [href]="display.ramblersWalkBaseUrl + walk.ramblersWalkId">
                                            <span class="related-links-title"
                                                  tooltip-placement="left"
                                                  tooltip="Click to view on Ramblers Walks and Events Manager">
                                          Ramblers: {{walk.briefDescriptionAndStartPoint}}</span></a>
              </div>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="row thumbnail thumbnail-campaign-settings third-party-panel">
              <div class="thumbnail-heading">Meetup</div>
              <div class="form-group">
                <label for="meetup-event-url">Link to Meetup event:</label>
                <select class="form-control input-sm"
                        [(ngModel)]="meetupEvent"
                        (change)="meetupEventUrlChange(walk)"
                        class="form-control round spaced-controls"
                        id="meetup-event-url">
                  <option *ngFor="let meetupEvent of display.meetupEvents"
                          [ngValue]="meetupEvent"
                          [textContent]="meetupEvent | meetupEventSummary">
                  </option>
                </select>
              </div>
              <div *ngIf="canUnlinkMeetup()">
                <div class="row">
                  <div class="col-sm-12">
                    <input type="submit" value="Unlink"
                           (click)="unlinkMeetup()"
                           title="Remove link between this walk and Meetup"
                           class="button-form">
                  </div>
                </div>
              </div>
              <div *ngIf="false" class="form-group">
                <label for="meetup-title">Meetup event title</label>
                <input [(ngModel)]="walk.meetupEventTitle"
                       type="text" value="" class="form-control input-sm"
                       id="meetup-title"
                       placeholder="Enter optional title for Meetup event">
              </div>
              <div class="form-group force-to-bottom" *ngIf="walk.meetupEventUrl">
                <h3>Meetup Link Preview</h3>
                <img class="related-links-image" src="assets/images/local/meetup.ico"
                     alt=""/>
                <a target="_blank"
                   [href]="walk.meetupEventUrl">
                                            <span class="related-links-title"
                                                  tooltip-placement="left"
                                                  tooltip="Click to view this walk in Meetup">
                                          Meetup: {{walk.meetupEventTitle || walk.briefDescriptionAndStartPoint}}</span></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </tab>
    <tab *ngIf="allowHistoryView()" heading="History">
      <div class="thumbnail thumbnail-admin-edit">
        <div class="form-group">
          <table
            class="round tbl-green-f table-striped table-hover table-condensed table-pointer">
            <thead>
            <tr>
              <th>Date</th>
              <th>Who</th>
              <th>Description</th>
              <th>Notes</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let event of walkEvents(walk)">
              <td style="width: 25%" [textContent]="event.date"></td>
              <td style="width: 15%"
                  [textContent]="event.member"></td>
              <td style="width: 20%"
                  [textContent]="event.eventType"></td>
              <td style="width: 40%"><span tooltip-placement="left"
                                           tooltip="Details: {{event.changedItems}}">{{event.notes}}</span>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </tab>

  </tabset>
  <div class="thumbnail" *ngIf="allowEdits() && walk && walk.walkLeaderMemberId">
    <h3>Create {{myOrWalkLeader()}} walk based on an existing one:</h3>
    <div class="row">
      <div class="col-sm-12">
        <div class="radio-inline map-radio-group map-radio-label">

          <input [disabled]="false"
                 id="copy-selected-walk-leader" type="radio"
                 [(ngModel)]="copySource"
                 (change)="populateWalkTemplates()"
                 value="copy-selected-walk-leader"/>
          <label for="copy-selected-walk-leader">Previously led by: <select
            class="form-control input-sm input-led-by"
            [(ngModel)]="copySourceFromWalkLeaderMemberId"
            (change)="selectCopySelectedLeader()"
            id="copy-member-walks">
            <option value="">(no walk leader selected)</option>
            <option *ngFor="let member of membersWithAliasOrMe()"
                    [ngValue]="member.memberId"
                    [textContent]="member.name">
            </option>
          </select>
          </label>

          <input id="copy-with-os-maps-route-selected" type="radio"
                 [(ngModel)]="copySource"
                 (change)="populateWalkTemplates()"
                 value="copy-with-os-maps-route-selected"/>
          <label for="copy-with-os-maps-route-selected">With an OS Maps route I can follow</label>

        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 mt-8">
        <label for="copy-walks-list">
          Copy from {{copyFrom.walkTemplates.length || 0}} available walk(s): </label>
        <select
          [disabled]="!allowEdits()" class="form-control input-sm fit-to-contents"
          [(ngModel)]="copyFrom.walkTemplate"
          (change)="populateCurrentWalkFromTemplate()"
          id="copy-walks-list">
          <option value="">(none selected)</option>
          <option *ngFor="let walkTemplate of copyFrom.walkTemplates"
                  [ngValue]="walkTemplate"
                  [textContent]="walkTemplate | walkSummary"></option>
        </select>
      </div>
    </div>
  </div>
  <div class="form-group">
    <div [hidden]="!notifyTarget.showAlert" class="alert {{notifyTarget.alertClass}}">
      <i class="glyphicon {{notifyTarget.alert.icon}}"></i> <strong>{{notifyTarget.alertTitle}}</strong>
      <span>{{notifyTarget.alertMessage}}</span>
    </div>
  </div>
  <div *ngIf="display.walkLink(walk)">
    <label><a href="#" popover="Link has been copied to clipboard"
              triggers="" #pop="bs-popover"
              (click)="display.copyWalkToClipboard(walk, pop)"
              [outsideClick]="true">
      <i class="glyphicon glyphicon-copy markdown-preview-icon fa-lg">
        <div tooltip-placement="left"
             tooltip="Click to copy link to clipboard"></div>
      </i>
      copy link </a> to this <a [href]="display.walkLink(walk)"
                                target="_blank">walk</a></label>
  </div>
  <div *ngIf="walk">
    <input *ngIf="allowClose()" [disabled]="saveInProgress" type="submit"
           value="Close"
           (click)="closeEditView()" title="Close and go back to walks list"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form'">
    <input *ngIf="allowSave()" [disabled]="saveInProgress" type="submit" value="Save"
           (click)="saveWalkDetails()" title="Save these walk details"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form'">
    <input *ngIf="allowCancel()" [disabled]="saveInProgress" type="submit"
           value="Cancel"
           (click)="cancelWalkDetails()" title="Cancel and don't save"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form'">
    <input *ngIf="pendingCancel()" [disabled]="saveInProgress" type="submit"
           value="Confirm" (click)="confirmCancelWalkDetails()"
           title="Confirm losing my changes and closing this form"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form button-confirm'">
    <input *ngIf="allowDelete()" [disabled]="saveInProgress" type="submit"
           value="Delete"
           (click)="deleteWalkDetails()" title="Delete these walk details"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form'">
    <input *ngIf="pendingDelete()" [disabled]="saveInProgress" type="submit"
           value="Confirm Deletion" (click)="confirmDeleteWalkDetails()"
           title="Confirm Delete of these walk details"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form button-confirm'">

    <input *ngIf="allowRequestApproval()" [disabled]="saveInProgress" type="submit"
           value="Request Approval" (click)="requestApproval()"
           title="Mark walk details complete and request approval"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form'">
    <input *ngIf="pendingRequestApproval()" [disabled]="saveInProgress"
           type="submit"
           value="Confirm Request Approval" (click)="confirmRequestApproval()"
           title="Confirm walk details complete and request approval"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form green-confirm'">
    <input *ngIf="allowContactOther()" [disabled]="saveInProgress" type="submit"
           value=""
           (click)="contactOther()" title="Contact {{personToNotify()}}"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form'">
    <input *ngIf="pendingContactOther()" [disabled]="saveInProgress" type="submit"
           value="Contact {{personToNotify()}}" (click)="confirmContactOther()"
           title="Contact {{personToNotify()}} via email"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form green-confirm'">

    <input *ngIf="pendingConfirmation()" type="submit" value="Cancel" (click)="cancelConfirmableAction()"
           title="Cancel this action"
           [ngClass]="saveInProgress ? 'disabled-button-form': 'button-form amber-confirm'">
    <div *ngIf="allowNotifyConfirmation() && !saveInProgress" class="row">
      <div class="col-sm-12">
        <div class="checkbox-group checkbox-group-in-footer">
          <label [ngClass]="{'ui-state-active': sendNotifications}"
                 for="send-notification">Notify {{personToNotify()}} about this change
            <input [disabled]="!allowNotifyConfirmation() ||saveInProgress "
                   [(ngModel)]="sendNotifications"
                   type="checkbox" id="send-notification">
          </label>
        </div>
      </div>
    </div>
  </div>
</div>
