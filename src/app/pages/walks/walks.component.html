<div [ngClass]="{'busy': notify.busy}">
  <div class="wrapper">
    <div id="page-body" role="main">
      <div class="body-header">
        <div class="breadcrumbs">
          <ul>
            <li><a href="/" title="Home">Home</a></li>
            <li class="last">Walks</li>
          </ul>
        </div>
      </div>
      <uib-accordion class="accordion accordion-style" close-others="false">
        <uib-accordion-group is-open="walksProgrammeOpen">
          <uib-accordion-heading>
            <div class="accordion-title">
              <img src="assets/images/ramblers/icon-gowalking.png" class="accordion-image"
                   alt="Walks Programme">Walks Programme<i class="pull-right fa fa-lg darkred"
                                                           [ngClass]="{'fa fa-minus-circle': walksProgrammeOpen, 'fa fa-plus-circle': !walksProgrammeOpen}"></i>
            </div>
          </uib-accordion-heading>
          <form class="form-inline search-heading" role="form">
            <div class="form-group">
              <input [(ngModel)]="filterParameters.quickSearch"
                     class="form-control round spaced-controls"
                     type="text" placeholder="Quick Search">
            </div>
            <div class="form-group">
              <select [(ngModel)]="filterParameters.selectType" (change)="refreshWalks()"
                      class="form-control round spaced-controls">
                <option selected="selected" value="1">Walks Today Onwards</option>
                <option value="2">Past Walks</option>
                <option value="3">All Walks</option>
                <option value="4">Walks With No Leader</option>
                <option value="5">Walks With No Details</option>
              </select>
            </div>
            <div class="form-group">
              <select [(ngModel)]="filterParameters.ascending" (change)="refreshWalks()"
                      class="form-control round spaced-controls">
                <option selected value="true">Sort (date ascending)</option>
                <option value="false">Sort (date descending)</option>
              </select>
            </div>
            <div class="form-group">
              <div *ngIf="notify.showAlert" class="alert walks-programme-alert {{notify.alertClass}}"><i
                class="glyphicon {{notify.alert.icon}}"></i>
                <strong>{{notify.alertTitle}}</strong> {{notify.alertMessage}}
              </div>
            </div>
          </form>
          <div class="walk-action-button-group">
            <div *ngIf="allow.adminEdits()" class="row">
              <div class="col-sm-12">
                <form class="form-inline">
                  <input *ngIf="allow.adminEdits()" type="submit" value="Ramblers export"
                         (click)="selectWalksForExport()"
                         title="Select walks to export in Ramblers format" class="button-form">
                  <input *ngIf="allow.adminEdits()" type="submit" value="Add more walk slots"
                         (click)="addWalkSlotsDialog()"
                         title="Add more available slots on the walks programme" class="button-form">
                  <input *ngIf="allow.showAll()" type="submit" value="Show All Walks"
                         (click)="showAllWalks()" title="Show All Walks" class="button-form">
                </form>
              </div>
            </div>
          </div>
          <div *ngFor="let walk of filteredWalks; let $index = index">
            <div class="thumbnail event-thumbnail" *ngIf="isExpandedFor(walk)">
              <div class="row row-eq-height-xs">
                <div class="col-sm-6 round">
                  <div class="panel-toggle"
                       tooltip-placement="left"
                       uib-tooltip="Click to hide walk detail"
                       (click)="toggleViewFor(walk)">
                    <h1><span [(ngModel)]="walk.walkDate | displayDay"></span> <span
                      [(ngModel)]="durationInFutureFor(walk)"
                      class="badge event-badge blue-badge"></span> <span *ngIf="nextWalk(walk)"
                                                                         class="badge event-badge next-event-badge"> Our next walk</span>
                    </h1>
                    <div *ngIf="eventTypeFor(walk).showDetails">
                      <h2>
                        <span [(ngModel)]="walk.briefDescriptionAndStartPoint"></span>
                      </h2>
                      <h3 *ngIf="walk.startTime">Start Time:
                        <span
                          [(ngModel)]="walk.startTime"></span>
                      </h3>
                    </div>
                  </div>
                  <input *ngIf="toWalkEditMode(walk)" type="submit"
                         value="{{toWalkEditMode(walk).caption}}"
                         (click)="actionWalk(walk)"
                         title="{{toWalkEditMode(walk).caption}}"
                         class="button-form button-form-edit-event">

                  <div *ngIf="eventTypeFor(walk).showDetails" class="event-description">
                    <div class="green-bullets-no-rule">
                      <p btf-markdown="walk.longerDescription"></p>
                    </div>
                  </div>
                  <div
                    *ngIf="eventTypeFor(walk).showDetails && (walk.meetupEventUrl || walk.osMapsRoute || walk.osMapsRoute || walk.ramblersWalkId || userEdits.walkLink(walk))"
                    class="event-panel round event-panel-inner">
                    <h1>Related Links</h1>

                    <div *ngIf="walk.meetupEventUrl" class="row related-links-row">
                      <div class="col-sm-1">
                        <img class="related-links-image"
                             src="assets/images/local/meetup.ico"
                             alt="Meetup: {{walk.osMapsTitle || walk.briefDescriptionAndStartPoint}}"/>
                      </div>
                      <div class="col-sm-11">
                        <a target="_blank"
                           [href]="walk.meetupEventUrl">
                                    <span class="related-links-title"
                                          tooltip-placement="left"
                                          uib-tooltip="Click to view the route for this walk on Meetup">
                                  Meetup: {{walk.meetupEventTitle || walk.briefDescriptionAndStartPoint}}</span></a>
                      </div>
                    </div>

                    <div *ngIf="walk.ramblersWalkId" class="row related-links-row">
                      <div class="col-sm-1">
                        <img class="related-links-image"
                             src="assets/images/ramblers/favicon.ico"
                             alt="Meetup: {{walk.osMapsTitle || walk.briefDescriptionAndStartPoint}}"/>
                      </div>
                      <div class="col-sm-11">
                        <a target="_blank"
                           class="follow"
                           [href]="ramblersWalkBaseUrl+walk.ramblersWalkId"
                           title="Preview on Ramblers Walks and Events Manager">
                                    <span class="related-links-title"
                                          tooltip-placement="left"
                                          uib-tooltip="Click to view on Ramblers Walks and Events Manager">
                                  Ramblers: {{walk.briefDescriptionAndStartPoint}}</span></a>
                      </div>
                    </div>
                    <div *ngIf="walk.osMapsRoute" class="row related-links-row">
                      <div class="col-sm-1">
                        <img class="related-links-image"
                             src="assets/images/local/ordnance-survey-untitled.png"
                             alt="Maps: {{walk.osMapsTitle || walk.briefDescriptionAndStartPoint}}"/>
                      </div>
                      <div class="col-sm-11">
                        <a target="_blank"
                           [href]="walk.osMapsRoute">
                                    <span class="related-links-title"
                                          tooltip-placement="left"
                                          uib-tooltip="Click to view the route for this walk on Ordnance Survey Maps">
                                  OS Maps: {{walk.osMapsTitle || walk.briefDescriptionAndStartPoint}}</span></a>
                      </div>
                    </div>
                    <div class="row related-links-row" *ngIf="userEdits.walkLink(walk)">
                      <div class="col-sm-12">
                        <label> <a href="" uib-popover="Link has been copied to clipboard"
                                   popover-trigger="focus"
                                   (click)="userEdits.copyToClipboard(userEdits.walkLink(walk))">
                          <i class="glyphicon glyphicon-copy markdown-preview-icon fa-lg"><span
                            tooltip-placement="left"
                            uib-tooltip="Click to copy link to clipboard"></span></i> copy link </a> to
                          this </label>
                        <a [href]="userEdits.walkLink(walk)"
                           target="_blank">walk</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 round" *ngIf="eventTypeFor(walk).showDetails">
                  <input type="number" min="1" max="20" *ngIf="false"
                         [(ngModel)]="googleMapsConfig.zoomLevel">
                  <iframe *ngIf="walk.postcode" class="map-thumbnail-image" frameborder="0"
                          style="border:0;border-radius: 10px;"
                          [src]="trustSrc(googleMaps(walk))" allowfullscreen></iframe>
                  <div class="row thumbnail thumbnail-campaign-settings">
                    <div class="map-radio-heading map-radio-group">Show Map:</div>
                    <form class="radio-inline map-radio-group map-radio-label">
                      <input id="show-start-point-{{$index}}" type="radio"
                             [(ngModel)]="userEdits.mapDisplay"
                             value="show-start-point"/>
                      <label for="show-start-point-{{$index}}">At start {{walk.postcode}}</label>
                      <input [disabled]="drivingDirectionsDisabled()"
                             id="show-driving-directions-{{$index}}" type="radio"
                             [(ngModel)]="userEdits.mapDisplay"
                             value="show-driving-directions"/>
                      <label for="show-driving-directions-{{$index}}">Driving from: <input
                        class="input-sm text-uppercase input-postcode"
                        [(ngModel)]="userEdits.fromPostcode"
                        [(ngModel)]-options="{debounce:1000}" (change)="autoSelectMapDisplay()"
                        type="text"></label>

                    </form>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6 round">
                  <div class="event-panel round">
                    <h1>Walk Leader</h1>
                    <div *ngIf="!eventTypeFor(walk).showDetails">
                      <div class="col-sm-12">
                        <p [(ngModel)]="eventTypeFor(walk).description"></p>
                      </div>
                    </div>
                    <div *ngIf="eventTypeFor(walk).showDetails">
                      <p *ngIf="walk.contactEmail"><i
                        class="glyphicon glyphicon-envelope markdown-preview-icon fa-lg"></i>

                        <a *ngIf="allow.detailView()"
                           [href]="mailto:{{walk.contactEmail}}">
                                    <span tooltip-placement="left"
                                          uib-tooltip="Click to email {{walk.displayName}} at {{walk.contactEmail}}">
                                        {{walk.displayName}}
                                    </span></a>
                        <span *ngIf="!allow.detailView()" class="tooltip-link"
                              tooltip-placement="left"
                              tooltip-trigger="mouseenter"
                              uib-tooltip="Login as an EKWG member and send an email to {{walk.displayName}}"
                              [(ngModel)]="walk.displayName"></span>
                      </p>
                      <p *ngIf="eventTypeFor(walk).showDetails"><i
                        class="glyphicon glyphicon-phone markdown-preview-icon fa-lg"></i>
                        <a [href]="tel:{{walk.contactPhone}}">
                                        <span tooltip-placement="left"
                                              uib-tooltip="Click to ring {{walk.displayName}} on {{walk.contactPhone}} (mobile devices only)">
                                            {{walk.contactPhone}}
                                        </span>
                        </a>
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 round">
                  <div class="event-panel round">
                    <h1>Walk Details</h1>
                    <div *ngIf="!eventTypeFor(walk).showDetails">
                      <div class="col-sm-12">
                        <p [(ngModel)]="eventTypeFor(walk).description"></p>
                      </div>
                    </div>
                    <div *ngIf="eventTypeFor(walk).showDetails">
                      <div class="row">
                        <div class="col-sm-6">Postcode:
                          <span [(ngModel)]="walk.location"></span>
                          <a [href]="http://maps.google.co.uk/maps?q={{walk.postcode}}"
                             target="_blank">
                                                <span tooltip-placement="left"
                                                      uib-tooltip="Click to locate postcode {{walk.postcode}} on Google Maps">
                                                    {{walk.postcode}}
                                                </span></a>
                        </div>
                        <div class="col-sm-6">
                                                <span *ngIf="walk.gridReference">Grid Ref: <a
                                                  [href]="http://gridreferencefinder.com/?gr={{walk.gridReference}}"
                                                  target="_blank">
                                            <span tooltip-placement="left"
                                                  uib-tooltip="Click to locate grid reference {{walk.gridReference}} on UK Grid Reference Finder">
                                                {{walk.gridReference}}
                                            </span></a>
                                                </span>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-6">Distance: <span [(ngModel)]="walk.distance"></span>
                        </div>
                        <div class="col-sm-6">Grade: <span [(ngModel)]="walk.grade"></span></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <table [hidden]="isExpandedFor(walk)"
                   class="round table tbl-green-f table-responsive table-striped table-hover table-condensed">
              <thead *ngIf="showTableHeader(walk)" class="tbl-green-f">
              <tr>
                <th *ngIf="loggedIn()" width="7%">Action</th>
                <th width="13%">Walk Date</th>
                <th width="7%">Start Time</th>
                <th width="32%">Description</th>
                <th width="7%">Distance</th>
                <th width="8%">Postcode</th>
                <th width="12%">Walk Leader</th>
                <th width="11%">Contact Phone</th>
              </tr>
              </thead>
              <tbody>
              <tr [ngClass]="tableRowOdd(walk)? 'active': 'default'">
                <td *ngIf="loggedIn()" width="7%" id="walkAction-{{$index}}" class="nowrap"><input
                  *ngIf="toWalkEditMode(walk)" type="submit"
                  value="{{toWalkEditMode(walk).caption}}"
                  (click)="actionWalk(walk)"
                  title="{{toWalkEditMode(walk).caption}}"
                  class="button-form">
                </td>
                <td width="13%" (click)="toggleViewFor(walk)"
                    id="walkDate-{{$index}}" class="nowrap">
                            <span tooltip-placement="left"
                                  uib-tooltip="Click to show walk detail"
                                  [(ngModel)]="walk.walkDate|displayDate"></span></td>
                <td width="7%" (click)="toggleViewFor(walk)"
                    id="startTime-{{$index}}">
                            <span tooltip-placement="left"
                                  uib-tooltip="Click to show walk detail"
                                  [(ngModel)]="viewWalkField(walk, 'startTime')"></span></td>
                <td width="32%" (click)="toggleViewFor(walk)"
                    id="briefDescription-{{$index}}">
                            <span tooltip-placement="left"
                                  uib-tooltip="Click to show walk detail"
                                  [(ngModel)]="viewWalkField(walk, 'briefDescriptionAndStartPoint')"></span></td>
                <td width="7%" (click)="toggleViewFor(walk)" id="distance-{{$index}}">
                            <span tooltip-placement="left" uib-tooltip="Click to show walk detail"
                                  [(ngModel)]="viewWalkField(walk, 'distance')"></span></td>
                <td width="8%" id="postcode-{{$index}}">
                  <a [href]="http://maps.google.co.uk/maps?q={{viewWalkField(walk, 'postcode')}}"
                     target="_blank">
                                <span tooltip-placement="left"
                                      uib-tooltip="Click to locate postcode {{viewWalkField(walk, 'postcode')}} on Google Maps"
                                      [(ngModel)]="viewWalkField(walk, 'postcode')"></span></a></td>
                <td width="12%" id="contactEmail-{{$index}}">
                  <a *ngIf="allow.detailView()" [href]="mailto:{{walk.contactEmail}}">
                                <span tooltip-placement="left"
                                      uib-tooltip="Click to email {{walk.displayName}} at {{viewWalkField(walk, 'contactEmail')}}"
                                      [(ngModel)]="walk.displayName"></span></a>
                  <span class="tooltip-link" *ngIf="!allow.detailView()" tooltip-placement="left"
                        (click)="loginOrLogout()" tooltip-trigger="mouseenter"
                        uib-tooltip="Click again to login as an EKWG member and send an email to {{walk.displayName}}"
                        [(ngModel)]="walk.displayName"></span></td>
                <td width="11%" id="contactPhone-{{$index}}">
                  <a *ngIf="allow.detailView()" [href]="tel:{{walk.contactPhone}}">
                            <span tooltip-placement="left"
                                  uib-tooltip="Click to ring {{walk.displayName}} on {{viewWalkField(walk, 'contactPhone')}} (mobile devices only)"
                                  [(ngModel)]="viewWalkField(walk, 'contactPhone')"></span></a> <a
                  *ngIf="!allow.detailView()" [href]="tel:{{walk.contactPhone}}">
                                <span tooltip-placement="left"
                                      uib-tooltip="Click to ring {{walk.displayName}} on {{viewWalkField(walk, 'contactPhone')}} (mobile devices only)"
                                      [(ngModel)]="viewWalkField(walk, 'contactPhone')"></span></a></td>
              </tr>
              </tbody>
            </table>
          </div>
        </uib-accordion-group>
        <uib-accordion-group is-open="walksInformationOpen">
          <uib-accordion-heading>
            <div class="accordion-title">
              <img src="assets/images/ramblers/icon-gowalking.png"
                   alt="Walks Information" class="accordion-image">Walks Information<i
              class="pull-right fa fa-lg darkred"
              [ngClass]="{'fa fa-minus-circle': walksInformationOpen, 'fa fa-plus-circle': !walksInformationOpen}"></i>
            </div>
          </uib-accordion-heading>
          <div class="body-content">
            <div class="row">
              <div class="col-sm-12">
                <markdown-editor class="event-description" name="walksInformation"
                                 description="walks information"></markdown-editor>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-9">
                <markdown-editor name="walksInformationSummary"
                                 description="walks summary"></markdown-editor>
              </div>
              <div class="col-sm-3">
                <markdown-editor name="walksInformationThumbnail"
                                 description="walks thumbnail"></markdown-editor>
              </div>
            </div>
          </div>
        </uib-accordion-group>
        <uib-accordion-group *ngIf="false" is-open="walksMapViewOpen">
          <uib-accordion-heading>
            <div class="accordion-title">
              <img src="assets/images/ramblers/icon-gowalking.png"
                   alt="View our past and planned walks on Google Maps!" class="accordion-image">View our
              past and planned walks on Google Maps!<i class="pull-right fa fa-lg darkred"
                                                       [ngClass]="{'fa fa-minus-circle': walksMapViewOpen, 'fa fa-plus-circle': !walksMapViewOpen}"></i>
            </div>
          </uib-accordion-heading>
          <p>If you are planning where to lead a walk and you want to make sure that you choose an area that
            hasn't been walked too much before,
            the map below provides you with a handy, visual way of verifying this.
          </p>

          <div class="green-bullets-no-rule">
            <ul>Some Tips
              <li>Zoom in to see more detail, then click on the pins to see who led the walk and on what
                date.
              </li>
              <li>Show or hide walks based on their date, distance, grid reference, or leader by selecting
                the appropriate drop-down in the map footer.
              </li>
              <li>You can then toggle filtering of the walks on the map by clicking/un-clicking the pins
                in the map footer.
              </li>
              <li>To reset the zoom on the map, just click the map heading.</li>
              <li>If you want to see the map below displayed full-screen then just click <a
                href="http://batchgeo.com/map/5053c28766e0bcebfdd6260de7ee593b">here</a>!
              </li>
              <li *ngIf="allow.edits()">As an <b>EKWG Walk admin</b> you an edit the map data below by
                clicking
                <a href="https://batchgeo.com/map/edit/?map_id=6468775&d=f709a249c90941f5d50383f916da3590">here</a>
              </li>
            </ul>
            <p>
              <iframe class="round" src="//batchgeo.com/map/5053c28766e0bcebfdd6260de7ee593b"
                      frameborder="0" width="100%" height="550"
                      style="border:1px solid #aaa;border-radius:10px;"></iframe>
            </p>
          </div>
        </uib-accordion-group>
      </uib-accordion>
    </div>
  </div>
</div>
