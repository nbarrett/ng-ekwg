<app-page [ngClass]="{'busy': notifyTarget.busy}" lastBreadcrumb="home" pageTitle="Walks">
  <form *ngIf="!currentWalkId" class="form-inline search-heading" role="form">
    <div class="form-group">
      <input [(ngModel)]="filterParameters.quickSearch" #quickSearch
             (ngModelChange)="onSearchChange($event)"
             name="quickSearch"
             class="form-control rounded spaced-controls"
             type="text" placeholder="Quick Search">
    </div>
    <div class="form-group">
      <select [(ngModel)]="filterParameters.selectType"
              (change)="refreshWalks('change filterParameters.selectType')" name="selectType"
              class="form-control rounded spaced-controls">
        <option *ngFor="let filter of walksFilter()" [ngValue]="filter.value"
                [selected]="filter.selected">{{filter.description}}</option>
      </select>
    </div>
    <div class="form-group">
      <select [(ngModel)]="filterParameters.ascending"
              (change)="refreshWalks('change filterParameters.ascending')" name="ascending"
              class="form-control rounded spaced-controls">
        <option selected value="true">Sort (date ascending)</option>
        <option value="false">Sort (date descending)</option>
      </select>
    </div>
    <div class="form-group">
      <div *ngIf="notifyTarget.showAlert" class="alert walks-programme-alert {{notifyTarget.alertClass}}"><fa-icon [icon]="notifyTarget.alert.icon"></fa-icon> <strong>{{notifyTarget.alertTitle}}</strong>
        {{notifyTarget.alertMessage}}
      </div>
    </div>
  </form>
  <div *ngFor="let displayedWalk of filteredWalks; let index = index; trackBy: walkTracker">
    <div *ngIf="display.isExpanded(displayedWalk.walk)" class="img-thumbnail event-thumbnail">
      <app-walk-view *ngIf="!display.isEdit(displayedWalk.walk)"
                     [displayedWalk]="displayedWalk"></app-walk-view>
      <app-walk-edit *ngIf="display.isEdit(displayedWalk.walk)"
                     [displayedWalk]="displayedWalk"></app-walk-edit>
    </div>
    <table *ngIf="!display.isExpanded(displayedWalk.walk)"
           class="round table tbl-green-f table-responsive table-striped table-hover table-condensed">
      <thead *ngIf="showTableHeader(displayedWalk)" class="tbl-green-f">
      <tr>
        <th *ngIf="memberLoginService.memberLoggedIn()" width="7%">Action</th>
        <th width="13%">Walk Date</th>
        <th width="7%">Start Time</th>
        <th width="32%">Walk Title</th>
        <th width="7%">Distance</th>
        <th width="8%">Postcode</th>
        <th width="12%">Walk Leader</th>
        <th width="11%">Contact Phone</th>
      </tr>
      </thead>
      <tbody>
      <tr [ngClass]="tableRowEven(displayedWalk)? 'default': 'active'">
        <td *ngIf="memberLoginService.memberLoggedIn()" width="7%" id="walkAction-{{index}}"
            class="nowrap"><input
          *ngIf="displayedWalk.walkAccessMode.walkWritable" type="submit"
          value="{{displayedWalk.walkAccessMode.caption}}"
          (click)="display.edit(displayedWalk)"
          class="button-form">
        </td>
        <td width="13%" (click)="display.view(displayedWalk.walk)"
            id="walkDate-{{index}}" class="nowrap">
                          <span tooltipPlacement="left"
                                tooltip="Click to show walk detail"
                                [textContent]="displayedWalk.walk.walkDate|displayDate" name="walkDate"></span></td>
        <td width="7%" (click)="display.view(displayedWalk.walk)"
            id="startTime-{{index}}">
                          <span tooltipPlacement="left"
                                tooltip="Click to show walk detail"
                                [textContent]="viewWalkField(displayedWalk, 'startTime')" name="startTime"></span>
        </td>
        <td width="32%" (click)="display.view(displayedWalk.walk)"
            id="briefDescription-{{index}}">
                          <span tooltipPlacement="left"
                                tooltip="Click to show walk detail"
                                [textContent]="viewWalkField(displayedWalk, 'briefDescriptionAndStartPoint')"
                                name="briefDescriptionAndStartPoint"></span></td>
        <td width="7%" (click)="display.view(displayedWalk.walk)" id="distance-{{index}}">
                          <span tooltipPlacement="left" tooltip="Click to show walk detail"
                                [textContent]="viewWalkField(displayedWalk, 'distance')" name="distance"></span></td>
        <td width="8%" id="postcode-{{index}}">
          <a [href]="'http://maps.google.co.uk/maps?q=' + viewWalkField(displayedWalk, 'postcode')"
             target="_blank">
                              <span tooltipPlacement="left"
                                    tooltip="Click to locate postcode {{viewWalkField(displayedWalk, 'postcode')}} on Google Maps"
                                    [textContent]="viewWalkField(displayedWalk, 'postcode')"
                                    name="postcode"></span></a></td>
        <td width="12%" id="contactEmail-{{index}}">
          <a *ngIf="allowDetailView()" [href]="'mailto:'+ displayedWalk.walk.contactEmail">
                              <span tooltipPlacement="left"
                                    tooltip="Click to email {{displayedWalk.walk.displayName}} at {{viewWalkField(displayedWalk, 'contactEmail')}}"
                                    [textContent]="displayedWalk.walk.displayName" name="displayName"></span></a>
          <span class="tooltip-link" *ngIf="!allowDetailView()" tooltipPlacement="left"
                (click)="loginOrLogout()" tooltipTrigger="mouseenter"
                tooltip="Click again to login as an EKWG member and send an email to {{displayedWalk.walk.displayName}}"
                [textContent]="displayedWalk.walk.displayName"></span></td>
        <td width="11%" id="contactPhone-{{index}}">
          <a *ngIf="allowDetailView()" [href]="'tel:' + displayedWalk.walk.contactPhone">
                          <span tooltipPlacement="left"
                                tooltip="Click to ring {{displayedWalk.walk.displayName}} on {{viewWalkField(displayedWalk, 'contactPhone')}} (mobile devices only)"
                                [textContent]="viewWalkField(displayedWalk, 'contactPhone')"
                                name="contactPhone"></span></a>
          <a *ngIf="!allowDetailView()" [href]="'tel:' + displayedWalk.walk.contactPhone">
                              <span tooltipPlacement="left"
                                    tooltip="Click to ring {{displayedWalk.walk.displayName}} on {{viewWalkField(displayedWalk, 'contactPhone')}} (mobile devices only)"
                                    [textContent]="viewWalkField(displayedWalk, 'contactPhone')"
                                    name="contactPhone"></span></a>
          <app-panel-expander [walk]="displayedWalk.walk" [expandable]="true"
                              [expandAction]="'show full details of walk'">
          </app-panel-expander>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</app-page>
