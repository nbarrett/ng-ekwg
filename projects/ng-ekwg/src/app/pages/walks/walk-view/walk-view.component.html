<app-panel-expander [walk]="displayedWalk.walk" [expandable]="allowWalkAdminEdits"
                    [collapsable]="true" [collapseAction]="'collapse'">
</app-panel-expander>
<div class="row">
  <div class="col-sm-6 rounded">
    <div class="panel-toggle">
      <h1 name="walkDate">{{displayedWalk.walk.walkDate | displayDay}}
        <div name="durationInFuture"
             class="badge event-badge blue-badge">{{durationInFutureFor(displayedWalk.walk)}}</div>
        <div *ngIf="display.isNextWalk(displayedWalk.walk)"
             class="badge event-badge next-event-badge"> Our next walk</div>
      </h1>
      <div *ngIf="displayedWalk.latestEventType.showDetails">
        <h2>
                      <span [textContent]="displayedWalk.walk.briefDescriptionAndStartPoint"
                            name="briefDescriptionAndStartPoint"></span>
        </h2>
        <h3 *ngIf="displayedWalk.walk.startTime">Start Time:
          <span
            [textContent]="displayedWalk.walk.startTime" name="startTime"></span>
        </h3>
      </div>
    </div>
    <input *ngIf="displayedWalk.walkAccessMode.walkWritable" type="submit"
           value="{{displayedWalk.walkAccessMode.caption}}"
           (click)="display.edit(displayedWalk)"
           title="{{displayedWalk.walkAccessMode.caption}}"
           class="button-form button-form-edit-event">

    <div *ngIf="displayedWalk.latestEventType.showDetails" class="event-description">
      <div class="green-bullets-no-rule">
        <p markdown [data]="displayedWalk.walk.longerDescription"></p>
      </div>
    </div>
    <div *ngIf="displayedWalk.latestEventType.showDetails && displayLinks"
         class="event-panel rounded event-panel-inner">
      <h1>Related Links</h1>
      <div class="row">
        <div class="col-sm-6">
          <ul class="list-unstyled">
            <app-related-link [mediaWidth]="relatedLinksMediaWidth" *ngIf="displayedWalk.walk.meetupEventUrl">
              <img title class="related-links-image"
                   src="/assets/images/local/meetup.ico"
                   alt="View {{meetupService.meetupPublishedStatus(displayedWalk)}} event on Meetup"/>
              <a content target="_blank"
                 [href]="displayedWalk.walk.meetupEventUrl">
                <div class="related-links-title"
                     tooltip="Click to view the route for this walk on Meetup">
                  View {{meetupService.meetupPublishedStatus(displayedWalk)}} event on Meetup
                </div>
              </a>
            </app-related-link>
            <app-related-link [mediaWidth]="relatedLinksMediaWidth" *ngIf="displayedWalk.walk.ramblersWalkId">
              <img title class="related-links-ramblers-image"
                   src="favicon.ico"
                   alt="View walk on Ramblers"/>
              <a content tooltip="Click to view on Ramblers Walks and Events Manager" target="_blank"
                 [href]="displayedWalk.ramblersLink">View walk on Ramblers</a>
            </app-related-link>
            <app-related-link [mediaWidth]="relatedLinksMediaWidth" *ngIf="displayedWalk.walk.osMapsRoute">
              <img title class="related-links-image"
                   src="/assets/images/local/ordnance-survey-untitled.png"
                   alt="View map on OS Maps"/>
              <a content tooltip="Click to view the route for this walk on Ordnance Survey Maps"
                 target="_blank"
                 [href]="displayedWalk.walk.osMapsRoute">
                View map on OS Maps
              </a>
            </app-related-link>
            <app-related-link [mediaWidth]="relatedLinksMediaWidth"
                              *ngIf="displayedWalk?.walk?.venue?.venuePublish && (displayedWalk?.walk?.venue?.url||displayedWalk?.walk?.venue?.postcode)">
              <fa-icon title [icon]="displayedWalk.walk.venue.type | toVenueIcon" class="fa-icon"></fa-icon>
              <a content tooltip="Click to visit {{displayedWalk.walk.venue.name}}"
                 [href]="displayedWalk.walk.venue.url || googleMapsService.urlForPostcode(displayedWalk.walk.venue.postcode)"
                 target="_blank">
                {{displayedWalk.walk.venue.type}}: {{displayedWalk.walk.venue.name}}
              </a>
            </app-related-link>
            <app-related-link [mediaWidth]="relatedLinksMediaWidth" *ngIf="displayedWalk.walkLink">
              <fa-icon title [icon]="faCopy" class="fa-icon"><span
                tooltip="Click to copy link to clipboard"
                tooltipPlacement="left"></span></fa-icon>
              <div content>
                <a popover="Link has been copied to clipboard"
                   class="related-links-gylph-title"
                   triggers="" #pop="bs-popover"
                   (click)="display.copyWalkToClipboard(displayedWalk.walk, pop)"
                   [outsideClick]="true"
                   placement="bottom">
                  Copy link</a> to this <a [href]="displayedWalk.walkLink " target="_blank">walk</a>
              </div>
            </app-related-link>
          </ul>
        </div>
      </div>
    </div>

    <div class="event-panel rounded">
      <h1>Walk Leader</h1>
      <div *ngIf="!displayedWalk.latestEventType.showDetails">
        <div class="col-sm-12">
          <p [textContent]="displayedWalk.latestEventType.description" name="description"></p>
        </div>
      </div>
      <div *ngIf="displayedWalk.latestEventType.showDetails">
        <div class="row">
          <div class="col-sm-6">
            <ul class="list-unstyled">
              <app-related-link [mediaWidth]="relatedLinksMediaWidth" *ngIf="displayedWalk.walk.contactEmail">
                <fa-icon title [icon]="faEnvelope" class="fa-icon"></fa-icon>
                <div content>
                  <a *ngIf="loggedIn" [href]="'mailto:' + displayedWalk.walk.contactEmail"
                     tooltip="Click to email {{displayedWalk.walk.displayName}} at {{displayedWalk.walk.contactEmail}}">
                    {{displayedWalk.walk.displayName}}
                  </a>
                  <span (click)="login()" *ngIf="!loggedIn" class="tooltip-link span-margin"
                        tooltip-trigger="mouseenter"
                        tooltip="Login as an EKWG member and send an email to {{displayedWalk.walk.displayName}}">
          {{displayedWalk.walk.displayName}}</span></div>
              </app-related-link>
              <app-related-link [mediaWidth]="relatedLinksMediaWidth">
                <fa-icon title [icon]="faPhone" class="fa-icon"></fa-icon>
                <a content [href]="'tel:' + displayedWalk.walk.contactPhone" name="contactPhone"
                   tooltip="Click to ring {{displayedWalk.walk.displayName}} on {{displayedWalk.walk.contactPhone}} (mobile devices only)">
                  {{displayedWalk.walk.contactPhone}}
                </a>
              </app-related-link>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 rounded" *ngIf="displayedWalk.latestEventType.showDetails">
    <div class="row">
      <div class="col-sm-12">
        <iframe *ngIf="displayedWalk.walk.postcode" class="map-thumbnail-image"
                style="border:0;border-radius: 10px;"
                [src]="googleMapsUrl" allowfullscreen></iframe>
      </div>
    </div>
    <div class="row rounded img-thumbnail map-radio-frame" (click)="refreshView()">
      <label class="ml-2 mr-2 font-weight-bold">Show Map:</label>
      <div class="custom-control custom-radio custom-control-inline">
        <input class="custom-control-input" id="show-start-point" type="radio"
               [ngModel]="mapDisplay" name="mapDisplay"
               (ngModelChange)="changeShowDrivingDirections($event)"
               value="show-start-point"/>
        <label class="custom-control-label" for="show-start-point">At starting
          point {{displayedWalk.walk.postcode}}</label>
      </div>
      <div class="custom-control custom-radio custom-control-inline">
        <input class="custom-control-input" id="show-driving-directions" type="radio"
               (ngModelChange)="changeShowDrivingDirections($event)"
               [ngModel]="mapDisplay" name="mapDisplay"
               value="show-driving-directions"/>
        <label class="custom-control-label" for="show-driving-directions">Driving from postcode</label>
      </div>
      <input
        class="form-control input-sm text-uppercase ml-2 mr-2"
        [ngModel]="fromPostcode" name="fromPostcode"
        (ngModelChange)="changeFromPostcode($event)"
        (click)="autoSelectMapDisplay()"
        type="text">
    </div>
    <div class="event-panel rounded">
      <h1>Walk Details</h1>
      <div *ngIf="!displayedWalk.latestEventType.showDetails">
        <div class="col-sm-12">
          <p>{{displayedWalk.latestEventType.description}}</p>
        </div>
      </div>
      <div *ngIf="displayedWalk.latestEventType.showDetails" class="row">
        <div class="col-sm-6">
          <ul class="list-unstyled">
            <app-related-link [mediaWidth]="walkDetailsMediaWidth">
              <span title>Postcode</span>
              <div content>
                <span>{{displayedWalk.walk.location}}</span>
                <a tooltip="Click to locate postcode {{displayedWalk.walk.postcode}} on Google Maps"
                   [href]="googleMapsService.urlForPostcode(displayedWalk.walk.postcode)" target="_blank">
                  {{displayedWalk.walk.postcode}}</a>
              </div>
            </app-related-link>
            <app-related-link [mediaWidth]="walkDetailsMediaWidth" *ngIf="displayedWalk.walk.gridReference">
              <span title>Grid Ref</span>
              <a content [href]="display.gridReferenceLink(displayedWalk.walk)"
                 tooltip="Click to locate grid reference {{displayedWalk.walk.gridReference}} on UK Grid Reference Finder"
                 target="_blank">{{displayedWalk.walk.gridReference}}</a>
            </app-related-link>
          </ul>
        </div>
        <div class="col-sm-6">
          <ul class="list-unstyled">
            <app-related-link [mediaWidth]="walkDetailsMediaWidth">
              <span title>Distance</span>
              <span content>{{displayedWalk.walk.distance}}</span>
            </app-related-link>
            <app-related-link [mediaWidth]="walkDetailsMediaWidth">
              <span title>Grade</span>
              <span content>{{displayedWalk.walk.grade}}</span>
            </app-related-link>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
